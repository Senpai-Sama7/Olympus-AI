groups:
- name: olympus.rules
  rules:
  - alert: HighLatencyP95
    expr: histogram_quantile(0.95, sum by (le, route) (rate(request_duration_seconds_bucket{job="olympus_app"}[5m]))) > 1
    for: 2m
    labels: { severity: page }
    annotations:
      summary: "High p95 latency on {{ $labels.route }}"
      description: "p95 > 1s for 2m. Check queue_depth, CPU, recent deploy (git_sha/config_hash)."

  - alert: ErrorRateSpike
    expr: sum by (route) (rate(errors_total{job="olympus_app"}[1m])) > 0.5
    for: 1m
    labels: { severity: page }
    annotations:
      summary: "Error rate spike on {{ $labels.route }}"
      description: "Errors > 0.5/s. Look for sentinel codes in logs and breaker state."

  - alert: CircuitOpen
    expr: max_over_time(circuit_open{job="olympus_app"}[30s]) > 0
    for: 30s
    labels: { severity: page }
    annotations:
      summary: "Circuit breaker OPEN"
      description: "Upstream flaky or slow. Breaker open >30s. Investigate dependency health, timeouts, caching."

  - alert: QueueBacklogGrowing
    expr: avg_over_time(queue_depth{job="olympus_app"}[2m]) > 10
    for: 2m
    labels: { severity: warn }
    annotations:
      summary: "Queue backlog growing"
      description: "In-flight work consistently >10. Scale workers or add backpressure."
